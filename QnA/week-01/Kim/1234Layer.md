# 네트워크 - 01

### 기본 개념

- **`패킷`** : 네트워크를 통해 송수신되는 데이터 단위
    - **`페이로드`** : 패킷에서 송수신하고자 하는 실제 데이터
    - **`헤더`** : 패킷에 추가되는 부가 정보, 패킷의 내용, 출발지 주소 + 목적지 주소, 최소 TCP헤더와 IP헤더를 가진다.
    - **`트레일러`** : 패킷 뒤에 위치, 패킷에 추가되는 부가 정보

- 전송 방식
    - **`유니 캐스트`** : 일대일로 메시지 송수신
    - **`브로드캐스트`** : 네트워크상의 모든 호스트에게 메시지 전송
    - **`멀티캐스트`** : 네트워크 내 동일 그룹에 속한 호스트에게만 전송
    - **`애니캐스트**` : 동일 그룹에 속한 호스트 중 가장 가까운 호스트에게 전송.

# 물리 계층

## 이더넷

: 통신 매체를 통해 신호를 송수신하는 방법, 데이터 링크 계층에서 주고받는 데이터 형식등이 정의된 기술.

- LAN(유선) 대부분이 이더넷 표준을 따르기 때문에 대다수의 LAN 장비들이 특정 이더넷 표준.
- 이더넷 표준이 다른 경우 → 신호 송수신 방법, 최대 지원 속도 차이

## 이더넷 프레임

### 헤더 부분

- `프리앰블` :
    - 송수신지 동기화를 위해 사용되는 8바이트(64비트)
    - 첫 7바이트는 1010101010 / 마지막 바이트는 10101011
- `송수신지 MAC`:
    - 송신지와 수신지를 특정할 수 있는 6바이트 길이의 MAC 주소
    - 각 네트워크 인터페이스마다 1개씩 부여되는 주소.
    - 네트워크 인터페이스
        
        네트워크를 향하는 통로, 연결 매체와의 연결 지점
        NIC 장치가 네트워크 인터페이스 담당.
        
- `타입/길이`
    - 크기 ≤ 1500 : 프레임의 크기
    - 크기 ≥ 1536 : 타입(캡슐화된 상위 계층의 정보 의미)
- 데이터
    - 상위 계층으로 전달하거나 전달받을 데이터 명시.
    - 데이터의 최대 크기가 정해져 있음.(1500바이트 이하)
- FCS
    - 프레임의 오류가 있는지 검증하기 위한 필드.
    - CRC : 오류 검출용 값 명시.(해시 함수 기반)
    - CRC 계산 방법
        1. 입력 데이터 뒤에 생성 다항식의 차수만큼 0 추가.
            1. 입력 데이터 : 1101
            2. Ex. 생성 다항식 : G(x) = x^3+x+1 ⇒ 차수:3 / 1011
            3. 데이터에 0 3개 추가 ⇒ 1101111
        2. XOR 기반 나눗셈
            1. 첫 번째 비트 1 ⇒ XOR 연산
            2. 첫 번째 비트 0 ⇒ 생성 다항식을 이동
            3. 자리수 맞추기 ⇒ 비트 단위 XOR 연산 진행.
        3. 최종 나머지 ⇒ CRC 코드

---

# 무선 LAN

### WIFI

- IEEE 802.11 표준을 따르는 무선 LAN 기술
- `채널` : 주파수 대역은 같은 대역을 사용하는 서로 다른 무선 네트워크를 구분하기 위한 하위 주파수 대역.
- 수동으로 설정도 가능.
- 신호가 중첩되지 않는 채널을 사용하는 것이 중요.

### 네트워크 인터페이스

- 네트워크 상에서 노드와 통신 매체가 연결되는 지점.
- 노드와 네트워크 사이의 통로.
- `NIC` : 네트워크 인터페이스의 역할 담당.
    - 통신 매체의 신호로 변환하는 역할
    - MAC주소를 토대로 잘못 전송된 패킷 없는지 확인.

### 허브 / 스위치

- 물리 계층 ↔ 허브/스위치 ↔ 링크 계층
- `허브` : 여러 대의 호스트를 연결하는 장치
    - 전이중/반이중 통신
    - 브로드캐스트 통신
    - 전달받은 신호를 모든 포트로 내보냄.
    - 반이중 모드로 통신
    - 반이중 통신?
        
        송신 또는 수신을 번갈아 가면서 수행해야 하는 통신 방식. 동시 송수신이 불가능한 상태 Like 무전기
        
- `스위치=L2 스위치`
    - 전달받은 신호를 목적지 호스트가 연결된 포트로만 전송.
    - 어떻게 목적지로만 전송할 수 있는가?
        
        스위치에는 MAC 주소 학습 기능 존재. 프레임 헤더에는 MAC 주소 명시 ⇒ 스위치는 데이터 링크 계층에 속한 자이 ⇒ MAC 주소 이해 가능. (MAC 주소 테이블)
        
    - 전이중 모드
    - VLAN : 가상의 LAN
        - 같은 스위치에 연결된 모든 호스트를 하나의 네트워크로 간주하고 싶지 않을 때.
        - 여러 논리적인 네트워크로 나누고 싶을 때

---

# 네트워크 계층

→ LAN를 넘어서 다른 네트워크 간 통신을 주고 받기 위해서는 네트워크 계층 이상의 기술 필요.

### IP : 신뢰할 수 없는 프로토콜이자, 비연결형 프로토콜

- 목적
    - `주소 지정` : 네트워크 간 통신 과정에서 호스트를 특정.
        - 주소 지정은 IP 주소 통해 이루어짐.
        - 1개의 IP 주소 ⇒ 총 4바이트(32비트)
        - 0~255 범위의 10진수 4개 표기.
        - IP 주소를 바탕으로 목적지까지 IP 패킷을 전달하는 네트워크 장비 ⇒ `라우터`
        - 라우터가 IP 패킷을 전달할 최적의 경로를 결정, 해당 경로로 패킷 전송 ⇒ `라우팅`
    - `단편화` : 데이터를 여러 IP 패킷으로 올바르게 쪼개어 보내는 것.
        - MTU : 최대 전송 단위
        - MTU < 보낼 IP 패킷 크기 : MTU이하의 여러 패킷으로 쪼개서 전송. ⇒ 전송된 패킷들은 수신지에서 재조합.
- ***신뢰할 수 없는 프로토콜*** : 패킷이 수신지까지 제대로 전송되었다고 보장하지 않는 프로토콜
- ***비연결형 프로토콜*** : 패킷을 주고받기 전에 사전 연결 과정을 거치지 않는것.

### IP 주소 = 네트워크 주소 + 호스트 주소

- IP 클래스
    - A : `0.0.0.0 ~ 127.255.255.255`
    - B : `128.0.0.0 ~ 191.255.255.255`
    - C : `192.0.0.0 ~ 223.255.255.255`
    - D : 멀티캐스트를 위한 클래스
    - E : 멀티캐스트를 위한 클래스
- 클래스리스 주소 체계
    - 클래스 주소 체계를 사용하면서 낭비되는 IP 문제를 해결하고자 클래스풀 주소 체계보다 더 정교하고 유동적으로 네트워크 영역을 나누는 수단.
    - 네트워크와 호스트를 클래스 없이 구분하는 방식.
    - 서브넷 마스크를 이용
    - 서브넷 마스크란?
        
        IP 주소상에서 네트워크 주소를 1로 표기 / 호스트 주소를 0으로 표기.
        
        A Class : 255.0.0.0 (11111111.00000000.00000000.00000000)
        
        B Class : 255.255.0.0 (11111111.11111111.00000000.00000000)
        
        C Class : 255.255.255.0 (11111111.11111111.11111111.00000000)
        
    - 서브넷 마스크 AND IP 주소 ⇒ IP 주소 내 네트워크 주소 알아낼 수 있음.
    - 사설IP : 고유하지 않은 IP 주소 , 사설 네트워크란 외부 네트워크에 공개되지 않은 네트워크. 라우터(공유기)를 통해 할당.
    - 공인IP : 고유한 IP 주소 , ISP나 공인 IP 주소 할당 기관을 통해 할당 가능.

### IP 주소의 할당

1. 정적 할당(수작업) 
    1. 부여하고자 하는 IP 주소 + 서브넷 마스크 + 게이트웨이 주소 + DNS 주소
    - 게이트 웨이
        
        일반적으로 서로 다른 네트워크를 연결하는 HW/SW 수단.
        
        기본 게이트웨이 : 호스트가 속한 네트워크의 외부로 나가기 위한 첫 기본 경로.
        
2. 동적 할당(DHCP,동적 주소)
    1. DHCP 서버와 메세지를 주고받으며 동적 IP 주소를 할당받을 수 있음.
    2. DHCP 서버는 호스트에 할당 가능한 IP 주소 목록을 관리하다가, IP 주소 할당 요청을 받았을 때 IP 주소 할당. 공유기가 DHCP 서버 역할.

### IP의 비연결형 통신 보완

1. 연결형 통신을 지원하는 상위 계층의 프로토콜 이용 - TCP
2. ICMP 이용 - IP 패킷의 전송 과정에 대한 피드백 메시지를 얻기 위해 사용하는 프로토콜. 패킷이 상대에게 어떻게 전송되었는지를 알려줄 수 있음.
3. 전송 과정 오류 보고 + 네트워크 진단 정보

### ARP

: 상대 호스트의 IP 주소는 알고, MAC 주소는 모르는 상황.

- 동일 네트워크 내에 있는 송수신 대사의 IP 주소⇒ MAC 주소 알아내는 프로토콜
1. ARP 요청 (브로드캐스트 메시지 = 알고 싶은 MAC 주소에 대응되는 IP 주소)
2. 네트워크 내 모든 호스트 수신.
3. ARP 요청 메시지에 포함된 IP 주소 확인 ⇒ 
    1. 자신과 관련없으면 무시
    2. 자신의 IP 주소이면 ARP 응답 메시지 전송.
    3. <IP 주소 , MAC 주소> 항목으로 구성된 ARP테이블에 정보 저장.

---

# **전송 계층**

- IP 주소 : 호스트 식별
- 포트 번호 : 애플리케이션 프로세스 식별
- 49152 ~ 65535 : 사설 포트, 임시 포트

### TCP : 신뢰성 프로토콜 + 연결형 프로토콜

- 패킷을 주고 받기 전 연결 수립 과정.
- 연결 수립 후 : 상태 관리 , 흐름 제어, 오류 제어, 혼잡 제어 기능 제공
- 속도가 느림.
- TCP 헤더 :
    - 순서 번호(패킷의 올바른 송수신 순서 보장을 위한 세그먼트 첫 바이트에 매겨진 번호)
    - 확인 응답 번호 (상대 호스트가 보낸 세그먼트에 대한 응답, 다음 수신 기대 순번)
    - 제어 비트 : 현재 세그먼트에 대한 부가 정보 (=플래그 비트)
        - ACK : 세그먼트 승인 비트
        - SYN : 연결 수립 비트
        - FIN : 연결 종료 비트
- TCP의 연결
    1. A→B : SYN 세그먼트 전송
    2. B→A : SYN+ACK 세그먼트 전송
    3. A→B : ACK 세그먼트 전송
- 오류 흐름 혼잡 제어
    1. `재전송 통한 오류 제어` : 타임 아웃 발생 시점까지 ACK 세그먼트를 받지 못하면 세그먼트 전송 과정 문제 발생 간주→세그먼트 재전송
    2. `흐름 제어` : 수신 호스트가 한 번에 받아 처리할 수 있을 만큼만 전송
    3. `혼잡 제어` : 많은 트래픽으로 패킷 처리 저하 및 유실될 수 있는 상황 제어
- TCP 종료
    1. A→B : FIN 세그먼트
    2. B→A : ACK 세그먼트
    3. B→A : FIN 세그먼트
    4. A→B : ACK 세그먼트
- TCP 상태 관리
    - TCP 상태 유지 관리 프로토콜 : 스테이트풀 프로토콜
    1. 연결이 수립되지 않았을 떄 주로 활용되는 상태
    2. 연결 수립 과정에서 주로 활용되는 상태
    3. 연결 종료 과정에서 주로 활용되는 상태

### UDP : 비신뢰성 프로토콜 + 비연결형 프로토콜

- 연결 수립 후 : 상태 관리 , 흐름 제어, 오류 제어, 혼잡 제어 기능 제공❌
- UDP 헤더 = 송신지포트 (송신 프로세스가 할당된 포트 번호) + 수신지 포트(수신 프로세스가 할당된 포트 번호) + 길이(헤더 포함 UDP 패킷의 바이트 크기) + 체크섬 (데이터그램 훼손 여부 알 수 있는 정보)
